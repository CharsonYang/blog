---
layout: post
title: "LCA 和 RMQ"
category: "算法"
---

<div style="line-height: 1.6; font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, Song, sans-serif;">
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">这篇文章主要谈谈 LCA (lowest common ancestor) ，即最近公共祖先问题的常见解法。</p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">1. 转换成链表交点问题</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">如果节点 i/j 内维护父节点的指针，则可以很容易地找到 i/j 到根节点的路径，问题变成了求两条链表在何处相交：</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><img alt="Alt text" class="en-media" longdesc="./1407323589036.png" name="1fb112fe-6ade-4798-8fa9-f8ed0ad487b7" src="https://www.evernote.com/shard/s133/sh/2c6e561b-f7b5-4855-8f6a-389a838a7108/4eb948f7ee01dac3c30347524825d3e6/res/1fb112fe-6ade-4798-8fa9-f8ed0ad487b7/1407323589036.png?resizeSmall&amp;width=832" style="border: 0; max-width: 100%; border-radius: 8px;"/></p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">上图中，7 和 10 的 LCA 即为 <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">7-3-1</code> 与 <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">10-8-3-1</code> 两条链表的交点 3。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">链表交点可以这样求：</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">遍历得到两条链表长度之差 m，再用两个指针分别指向两个 head，让长链表的那个指针先走 m 步，然后两个指针同时移动，直到指向同一个节点，该节点即为交点，如下图所示：</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><img alt="Alt text" class="en-media" longdesc="./1407324604832.png" name="339e0b7c-28b6-4553-864d-bc3f22537385" src="https://www.evernote.com/shard/s133/sh/2c6e561b-f7b5-4855-8f6a-389a838a7108/4eb948f7ee01dac3c30347524825d3e6/res/339e0b7c-28b6-4553-864d-bc3f22537385/1407324604832.png?resizeSmall&amp;width=832" style="border: 0; max-width: 100%; border-radius: 8px;"/></p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">2. 利用 DFS 转换成 RMQ (在线)</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">该算法的基本原理是，如果把一棵树 DFS 走过的路径 Path 记录下来（包括回溯时经过的节点），对于两个节点 i 和 j ，找到他们第一次出现在 Path 的位置，这之间的序列就表示 DFS 过程中从节点 i 出发访问到 j 的轨迹，其中，高度最低的节点即为二者的 LCA。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">以下图为例</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><img alt="Alt text" class="en-media" longdesc="./1407327658433.png" name="505d9cd6-d28b-4a18-a043-c8e14d261be9" src="https://www.evernote.com/shard/s133/sh/2c6e561b-f7b5-4855-8f6a-389a838a7108/4eb948f7ee01dac3c30347524825d3e6/res/505d9cd6-d28b-4a18-a043-c8e14d261be9/1407327658433.png?resizeSmall&amp;width=832" style="border: 0; max-width: 100%; border-radius: 8px;"/></p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">DFS路径如下：</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap; background: transparent;" xml:space="preserve"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 1em; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 8px; display: block; background: #23241f; margin: 0 4px;"><span style="color: #ae81ff;">1</span>  <span style="color: #ae81ff;">2</span>  <span style="color: #ae81ff;">1</span>  <span style="color: #ae81ff;">3</span>  <span style="color: #ae81ff;">4</span>  <span style="color: #ae81ff;">9</span>  <span style="color: #ae81ff;">4</span>  *<span style="color: #ae81ff;">3</span>*  <span style="color: #ae81ff;">5</span>
               ￣         ￣
</code></pre>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">9 到 5 的轨迹为 9-4-3-5，其中 3 最矮，它就是 9 和 5 的 LCA。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">实现上述逻辑需要两个数据结构：</p>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6;"><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">DFS 路径 <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">path</code>，每个元素还得额外保存节点高度；</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"> 对一棵二叉树而言，每个节点在 DFS 的过程中最多出现两次，因此 <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">path</code> 的长度最多为 2n。</p>
</li>
<li style="line-height: 1.6;">一个 map <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">firstOccur</code>，保存每个节点在<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">path</code>中出现的位置。</li>
</ol>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">于是问题转换为 RMQ。对 RMQ，<a href="http://novoland.github.io/算法/2014/07/26/线段树.html" style="background: transparent;" target="_blank">线段树</a>是一种可行的解法，它需要 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 2.817em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.113em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.734em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">O</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.432em; vertical-align: -0.425em;"></span></span></span></span></span> 的建树时间，<span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.899em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.734em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">O</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">l</span><span style="font-family:MathJax_Math, serif; font-style: italic;">o</span><span><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(1.897em 1000.003em 2.871em -0.484em); top: -2.486em; left: 0.003em;"><span style="font-family:MathJax_Math, serif; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.492em;"></span></span><span style="position: absolute; top: -2.054em; left: 0.544em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">2</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.432em; vertical-align: -0.425em;"></span></span></span></span></span> 的查询时间。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">这里介绍另一种基于动态规划，名为 <strong style="font-weight: bold;">Sparse Table</strong> 的算法。</p>
<h3 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 24px;">Sparse Table 算法</h3>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">Sparse Table 算法需要 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 5.955em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.494em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.734em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">O</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Math, serif; font-style: italic;">l</span><span style="font-family:MathJax_Math, serif; font-style: italic;">o</span><span><span style="display: inline-block; position: relative; width: 0.977em; height: 0px;"><span style="position: absolute; clip: rect(1.897em 1000.003em 2.871em -0.484em); top: -2.486em; left: 0.003em;"><span style="font-family:MathJax_Math, serif; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.492em;"></span></span><span style="position: absolute; top: -2.054em; left: 0.544em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">2</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.432em; vertical-align: -0.425em;"></span></span></span></span></span> 时间预处理，每次查询耗时 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 2.654em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.005em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.734em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">O</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Main, serif;">1</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.432em; vertical-align: -0.425em;"></span></span></span></span></span>；空间复杂度为 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.6em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.68em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">O</span><span style="font-family:MathJax_Main, serif;">(</span><span><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(1.897em 1000.003em 2.654em -0.484em); top: -2.486em; left: 0.003em;"><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 2.492em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.598em;"><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.575em; vertical-align: -0.425em;"></span></span></span></span></span>。</p>
<h4 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 25px; margin-bottom: 15px; font-size: 18px;">预处理</h4>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">首先需要一个矩阵 m，<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">m[i][j]</code>表示从索引 i 开始连续 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.139em 1000.003em 2.33em -0.43em); top: -2.162em; left: 0.003em;"><span><span><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.595em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.289em; vertical-align: -0.068em;"></span></span></span></span></span> 个数，即区间 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 7.091em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.36em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 3.087em -0.376em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.595em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span></span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.425em;"></span></span></span></span></span> 中的最小值。例如数列 a：</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap; background: transparent;" xml:space="preserve"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 0; color: inherit; background-color: transparent; white-space: pre-wrap; border-radius: 0; margin: 0 4px;">3 2 4 5 6 8 1 2 9 7
</code></pre><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">m[0][0]</code> 表示从 0 开始，长度为 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 3.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.762em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span><span><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">0</span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">=</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.289em; vertical-align: -0.068em;"></span></span></span></span></span> 的最大值，其实就是3这个数；因此 <code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">m[i][0]</code> 就等于<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">a[i]</code>，这就是 DP 的初始状态。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">接下来就是递推式了。由于<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">m[i][j]</code>代表的区间长度肯定是偶数，因此可以将其平均分成两段：</p>
<div style="margin: 20px 0; text-align: center;"><span></span><span style=""><div style="white-space: nowrap;"><span style="width: 15.1em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.42em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 3.087em -0.484em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">:</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.49em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">−</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.425em;"></span></span></div></span></div>
<div style="margin: 20px 0; text-align: center;"><span></span><span style=""><div style="white-space: nowrap;"><span style="width: 21.594em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.345em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 3.087em -0.484em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.49em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">−</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">:</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.49em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">−</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.814em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.595em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span></span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.425em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">递推式也就出来了：</p>
<div style="margin: 20px 0; text-align: center;"><span></span><span style=""><div style="white-space: nowrap;"><span style="width: 24.516em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.563em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 3.087em -0.484em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">=</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.273em;">m</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 1.734em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.649em; left: 0.49em;"><span><span><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">−</span><span style="font-size: 70.7%; font-family:MathJax_Main, serif;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.275em;"></span></span></span></span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.425em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">可以看到，DP 是从左向右一列一列进行的。</p>
<h4 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 25px; margin-bottom: 15px; font-size: 18px;">查询</h4>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">给定一个任意区间<code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 0 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 8px; margin: 0 4px;">[i,j]</code>，我们找到满足 <span style="display:inline-block;margin:0"><span></span><span style=""><span style="white-space: nowrap;"><span style="width: 7.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.847em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.951em 1000.003em 3.358em -0.43em); top: -2.973em; left: 0.003em;"><span><span><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.595em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span></span><span style="font-family:MathJax_AMS, serif; padding-left: 0.273em;">⩽</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.273em;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.219em;">i</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.979em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.575em; vertical-align: -0.354em;"></span></span></span></span></span>(区间内元素个数) 的最大的 k，则有:</p>
<div style="margin: 20px 0; text-align: center;"><span></span><span style=""><div style="white-space: nowrap;"><span style="width: 23.866em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.076em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.626em 1000.003em 3.087em -0.43em); top: -2.649em; left: 0.003em;"><span><span style="font-family:MathJax_Math, serif; font-style: italic;">R</span><span style="font-family:MathJax_Math, serif; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span style="font-family:MathJax_Math, serif; font-style: italic;">Q</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">j</span><span style="font-family:MathJax_Main, serif;">)</span><span style="font-family:MathJax_Main, serif; padding-left: 0.273em;">=</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.273em;">m</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Math, serif; font-style: italic;">n</span><span style="font-family:MathJax_Main, serif;">(</span><span style="font-family:MathJax_Math, serif; font-style: italic;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">i</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">k</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">,</span><span style="font-family:MathJax_Math, serif; font-style: italic; padding-left: 0.165em;">m</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">j</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">−</span><span style="padding-left: 0.219em;"><span style="display: inline-block; position: relative; width: 0.923em; height: 0px;"><span style="position: absolute; clip: rect(1.843em 1000.003em 2.817em -0.43em); top: -2.649em; left: 0.003em;"><span style="font-family:MathJax_Main, serif;">2</span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span><span style="position: absolute; top: -2.595em; left: 0.49em;"><span style="font-size: 70.7%; font-family:MathJax_Math, serif; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 2.221em;"></span></span></span></span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">+</span><span style="font-family:MathJax_Main, serif; padding-left: 0.219em;">1</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">[</span><span style="font-family:MathJax_Math, serif; font-style: italic;">k</span><span style="font-family:MathJax_Main, serif;">]</span><span style="font-family:MathJax_Main, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.654em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.425em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">举个例子，对于区间 [3,9]，取 k = 2 ，m[3][2] 和 m[6][2] 将这7个元素划分为两个 <strong style="font-weight: bold;">重叠</strong> 的部分，靠左4个，靠右4个，最小值即为它们中最小的那个。</p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">3. Tarjan 算法 (离线)</h2>
</div>